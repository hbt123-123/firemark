## 项目方案：AI驱动的社交化习惯追踪与计划拆解系统

### 一、项目概述

本项目是一个集固定日程管理、AI长期计划拆解、好友共享监督以及可扩展功能模块（如英语单词跟读）于一体的智能体应用。用户可以通过交互式对话设定长期目标，AI将目标拆解为每日任务并自动填入日程表；系统持续跟踪执行情况，定期反思并动态调整计划；好友之间可以查看彼此的日程进度、点赞评论；此外，应用提供可插拔的功能页面，收录版本迭代新增的特色功能（如英语单词跟读），用户可自由使用并反馈意见。

---

### 二、核心功能

1. **固定日程管理**  
   - 以周视图展示用户自定义的固定日程（如课程表、例会）。  
   - 支持添加、编辑、删除，可设置重复规则。  
   - 固定日程与AI生成的动态任务在时间线上融合展示。

2. **AI长期计划拆解**  
   - 多轮交互式对话收集用户目标信息（目标维度、要求维度、资源偏好）。  
   - 调用LLM生成结构化的计划大纲（里程碑、周计划）和每日任务。  
   - 用户确认后，任务自动存入日程表。

3. **执行跟踪与推送**  
   - 每日任务列表，支持勾选完成。  
   - 任务开始前30分钟推送提醒。  
   - 晚间推送复盘询问，收集反馈。

4. **智能体反思与调整**  
   - 根据每日执行日志（完成率、反馈），定期（每日/每周）触发反思。  
   - LLM分析问题（如难度过高、进度滞后），生成调整方案。  
   - 自动调整后续任务（难度、顺序、资源），或询问用户确认。

5. **好友共享与监督**  
   - 添加好友，查看好友的日程表和任务完成状态。  
   - 对好友的任务进行评论、点赞。  
   - 不实时推送任务完成通知，但可查看互动。

6. **多端同步**  
   - 支持Android App、Windows桌面应用、Web端，数据以服务器为准。  
   - 使用同一账号登录，数据实时同步。

7. **可扩展功能**  
   - 通过“功能”页面动态添加新模块，收集用户反馈。  
   - 英语单词跟读：用户选择词库、设置每日单词数和中英文重复次数，系统自动生成每日跟读任务，单词自动切换，无掌握标记，简单专注。

---

### 三、技术架构

| 层次 | 技术选择 | 说明 |
|------|----------|------|
| **后端** | Python + FastAPI | 高性能异步框架，自动生成API文档，适合微服务式智能体接口 |
| **数据库** | PostgreSQL | 支持JSONB、复杂查询、向量扩展（pgvector），满足记忆和反思需求 |
| **智能体框架** | LangChain + LangGraph（可选） | 管理多轮对话、技能调用、反思循环 |
| **技能封装** | 自定义Skill注册中心 | 每个技能（如计划生成、任务调整）为独立模块，通过统一接口调用 |
| **工具调用标准** | 仿MCP（模型上下文协议） | 统一工具接口（数据库查询、网络搜索、推送等），所有技能通过工具网关访问 |
| **记忆系统** | PostgreSQL + 向量检索（可选） | 结构化记忆存JSONB，长期记忆可借助pgvector实现语义检索 |
| **定时任务** | APScheduler | 用于每日推送、反思触发 |
| **推送通知** | 极光推送 + WebSocket | 手机端用极光，桌面端可用WebSocket或轮询 |
| **前端跨平台** | Flutter | 一套代码编译Android APK、Windows EXE、Web应用，UI美观，性能好 |
| **部署** | 轻量云服务器 + Nginx + Gunicorn | 1核2G可跑，支持HTTPS |

---

### 四、智能体核心流程（反思闭环）

```
用户输入目标
    ↓
[启动阶段] 多轮对话收集信息 (Objective/Requirements/Resources)
    ↓
[规划阶段] 调用生成计划技能 → 初始计划大纲 + 每日任务 (存入数据库)
    ↓
[执行阶段] 每日推送提醒，用户完成任务，记录完成情况 (执行日志)
    ↓
[监控阶段] 收集执行数据 (完成率、反馈、困难)
    ↓
[反思阶段] 定期（每日/每周）根据监控数据，调用反思LLM生成调整建议
    ↓
[调整阶段] 调用任务调整技能自动修改后续任务，或询问用户确认
    ↓
[循环] 继续执行，持续优化
```

**关键组件**：
- **技能（Skills）**：封装特定能力（如计划生成、任务调整），可调用工具和其他技能。
- **工具网关（Tool Gateway）**：提供统一接口访问数据库、外部API、推送等，所有工具需注册。
- **记忆系统**：短期记忆（对话上下文）、中期记忆（执行日志）、长期记忆（用户画像、重要事件）。
- **反思引擎**：定期分析执行情况，驱动计划动态优化。

---
### 五、新增模块：英语单词跟读功能
- 功能页面入口：底部导航新增“功能”页面，展示所有可用扩展功能（单词跟读等）。

- 单词库管理：预置四级、六级、雅思等词库，数据来自开源JSON库，包含单词、中文释义、音标、例句等，并预生成或按需生成中英文音频文件（存储在服务器或云存储）。

- 用户设置：

    选择词库类型（多选）。

    设置每日单词数量（例如10个）。

    设置英文重复次数（每个单词英文朗读几次，如2次）。

    设置中文重复次数（每个单词中文释义朗读几次，如1次）。

    开关：是否开启每日提醒。

- 每日跟读任务：系统每天根据用户设置，从所选词库中随机选取指定数量的单词，生成当日跟读列表。

- 跟读练习界面：

    同时显示当前单词的英文与中文释义，比自动依次播放英文音频（重复用户设定的次数）与中文音频（重复用户设定的次数）。

    完成后自动跳到下一个单词，无需用户标记掌握。

    界面显示当日进度（如“5/10”），可随时退出，下次进入从上次位置继续（或重置）。

- 数据记录：记录每日完成单词数（作为执行日志的一部分），用于统计和未来智能体分析。
### 六、开发模块清单（按顺序）

#### 后端模块（FastAPI + PostgreSQL）

| 模块 | 目标 | 关键内容 |
|------|------|----------|
| 1. 项目初始化 | 搭建项目结构，配置PostgreSQL | 目录结构、config、models（含10张表）、alembic |
| 2. 用户认证 | 注册、登录、JWT | auth路由，依赖项，密码哈希 |
| 3. 工具网关 | 实现统一工具调用接口 | 工具基类、注册器、示例工具（DB查询、搜索、推送） |
| 4. 技能框架 | 实现技能注册与执行 | 技能基类、注册器、示例技能（计划生成、任务调整） |
| 5. AI多轮对话 | 交互式收集信息，调用技能生成计划 | 对话状态管理、start/continue/confirm接口 |
| 6. 执行监控与日志 | 记录每日任务完成情况 | 执行日志表、任务状态更新时自动记录 |
| 7. 反思与调整 | 定期反思并调整计划 | 反思服务、定时任务、手动触发接口 |
| 8. 固定日程CRUD | 固定日程的增删改查 | 路由、Pydantic模型 |
| 9. 任务CRUD | 任务的增删改查，触发日志 | 路由、状态更新时记录日志 |
| 10. 好友关系 | 好友请求、接受、查看好友任务 | 好友路由 |
| 11. 评论点赞 | 任务评论/点赞的增删查 | 评论路由 |
| 12. 推送注册 | 用户注册推送token | 更新用户表 |
| 13. 定时推送 | 任务提醒、晚间复盘（调用工具） | 推送服务，APScheduler配置 |

#### 前端模块（Flutter）

| 模块 | 目标 | 关键内容 |
|------|------|----------|
| 14. 项目初始化 | 创建Flutter项目，添加依赖 | pubspec.yaml，目录结构 |
| 15. 登录注册 | 界面与后端交互，保存token | 页面、AuthProvider、SharedPreferences |
| 16. 主界面框架 | 底部导航（日程/任务/目标/好友/功能） | HomeScreen，五个占位页面 |
| 17. 固定日程页面 | 周视图展示，添加/编辑 | 周视图组件，API集成 |
| 18. 任务列表页面 | 按日期显示任务，勾选完成 | 任务列表，状态更新 |
| 19. 任务详情页 | 显示任务信息，评论点赞 | 评论列表，发表评论/点赞 |
| 20. 目标列表与AI对话 | 显示目标列表，启动AI对话 | GoalsScreen，AI对话界面（多轮气泡） |
| 21. 目标详情页（含反思） | 显示大纲、反思记录，手动触发反思 | Tab切换，反思历史列表，触发按钮 |
| 22. 好友列表与好友任务 | 显示好友，查看好友任务 | 好友列表，好友任务页（复用任务项） |
| 23. 功能页面 | 依次列出所加入功能，便于后续版本更新加入功能 | 英语单词跟读功能 |
| 24. 推送接收 | 集成极光推送，处理点击跳转 | 初始化，回调处理 |

#### 部署模块

| 模块 | 目标 | 关键内容 |
|------|------|----------|
| 24. 后端部署 | 部署FastAPI到Linux服务器 | PostgreSQL安装，Gunicorn+Uvicorn，Nginx，SSL |
| 25. 前端打包 | 生成APK、EXE、Web文件 | Flutter构建命令，Android签名 |

